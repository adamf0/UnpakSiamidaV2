
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>domain: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">UnpakSiamida/modules/fakultasunit/domain/FakultasUnit.go (100.0%)</option>
				
				<option value="file1">UnpakSiamida/modules/fakultasunit/domain/FakultasUnitCreatedEvent.go (0.0%)</option>
				
				<option value="file2">UnpakSiamida/modules/fakultasunit/domain/FakultasUnitErrors.go (100.0%)</option>
				
				<option value="file3">UnpakSiamida/modules/fakultasunit/domain/FakultasUnitUpdatedEvent.go (0.0%)</option>
				
				<option value="file4">UnpakSiamida/modules/indikatorrenstra/domain/IndikatorRenstra.go (96.0%)</option>
				
				<option value="file5">UnpakSiamida/modules/indikatorrenstra/domain/IndikatorRenstraCreatedEvent.go (0.0%)</option>
				
				<option value="file6">UnpakSiamida/modules/indikatorrenstra/domain/IndikatorRenstraErrors.go (100.0%)</option>
				
				<option value="file7">UnpakSiamida/modules/indikatorrenstra/domain/IndikatorRenstraUpdatedEvent.go (0.0%)</option>
				
				<option value="file8">UnpakSiamida/modules/jenisfile/domain/JenisFile.go (0.0%)</option>
				
				<option value="file9">UnpakSiamida/modules/jenisfile/domain/JenisFileErrors.go (100.0%)</option>
				
				<option value="file10">UnpakSiamida/modules/renstra/domain/Renstra.go (99.0%)</option>
				
				<option value="file11">UnpakSiamida/modules/renstra/domain/RenstraCreatedEvent.go (0.0%)</option>
				
				<option value="file12">UnpakSiamida/modules/renstra/domain/RenstraErrors.go (100.0%)</option>
				
				<option value="file13">UnpakSiamida/modules/renstra/domain/RenstraGiveCodeAccessEvent.go (0.0%)</option>
				
				<option value="file14">UnpakSiamida/modules/renstra/domain/RenstraUpdatedEvent.go (0.0%)</option>
				
				<option value="file15">UnpakSiamida/modules/standarrenstra/domain/StandarRenstra.go (90.9%)</option>
				
				<option value="file16">UnpakSiamida/modules/standarrenstra/domain/StandarRenstraCreatedEvent.go (0.0%)</option>
				
				<option value="file17">UnpakSiamida/modules/standarrenstra/domain/StandarRenstraErrors.go (100.0%)</option>
				
				<option value="file18">UnpakSiamida/modules/standarrenstra/domain/StandarRenstraUpdatedEvent.go (0.0%)</option>
				
				<option value="file19">UnpakSiamida/modules/tahunrenstra/domain/TahunRenstra.go (0.0%)</option>
				
				<option value="file20">UnpakSiamida/modules/tahunrenstra/domain/TahunRenstraErrors.go (100.0%)</option>
				
				<option value="file21">UnpakSiamida/modules/templatedokumentambahan/domain/TemplateDokumenTambahan.go (95.0%)</option>
				
				<option value="file22">UnpakSiamida/modules/templatedokumentambahan/domain/TemplateDokumenTambahanCreatedEvent.go (0.0%)</option>
				
				<option value="file23">UnpakSiamida/modules/templatedokumentambahan/domain/TemplateDokumenTambahanErrors.go (100.0%)</option>
				
				<option value="file24">UnpakSiamida/modules/templatedokumentambahan/domain/TemplateDokumenTambahanUpdatedEvent.go (0.0%)</option>
				
				<option value="file25">UnpakSiamida/modules/templaterenstra/domain/TemplateRenstra.go (97.4%)</option>
				
				<option value="file26">UnpakSiamida/modules/templaterenstra/domain/TemplateRenstraCreatedEvent.go (0.0%)</option>
				
				<option value="file27">UnpakSiamida/modules/templaterenstra/domain/TemplateRenstraErrors.go (100.0%)</option>
				
				<option value="file28">UnpakSiamida/modules/templaterenstra/domain/TemplateRenstraUpdatedEvent.go (0.0%)</option>
				
				<option value="file29">UnpakSiamida/modules/user/domain/User.go (95.2%)</option>
				
				<option value="file30">UnpakSiamida/modules/user/domain/UserCreatedEvent.go (0.0%)</option>
				
				<option value="file31">UnpakSiamida/modules/user/domain/UserErrors.go (100.0%)</option>
				
				<option value="file32">UnpakSiamida/modules/user/domain/UserUpdatedEvent.go (0.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">no coverage</span>
				<span class="cov1">low coverage</span>
				<span class="cov2">*</span>
				<span class="cov3">*</span>
				<span class="cov4">*</span>
				<span class="cov5">*</span>
				<span class="cov6">*</span>
				<span class="cov7">*</span>
				<span class="cov8">*</span>
				<span class="cov9">*</span>
				<span class="cov10">high coverage</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package domain

import (
        common "UnpakSiamida/common/domain"

        "github.com/google/uuid"
)

type FakultasUnit struct {
        common.Entity
        ID           uint       `gorm:""`
        UUID         uuid.UUID  `gorm:"type:char(36);"`
        Nama         string     `gorm:"column:nama_fak_prod_unit;"`
        KodeJenjang  string     `gorm:"column:kode_jenjang;"`
        Jenjang      string     `gorm:"column:jenjang;"`
        Type         string     `gorm:"column:type;"`
        Fakultas     string     `gorm:"column:fakultas;"`
}
func (FakultasUnit) TableName() string <span class="cov8" title="1">{
        return "v_fakultas_unit"
}</pre>
		
		<pre class="file" id="file1" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type FakultasUnitCreatedEvent struct {
        EventID    uuid.UUID
        FakultasUnitUUID    uuid.UUID
        OccurredOn time.Time
}

func (e FakultasUnitCreatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e FakultasUnitCreatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file2" style="display: none">package domain

import (
        "UnpakSiamida/common/domain"
        "fmt"
)

func EmptyData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("FakultasUnit.EmptyData", "data is not found")
}</span>

func InvalidUuid() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("FakultasUnit.InvalidUuid", "uuid is invalid")
}</span>

func InvalidData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("FakultasUnit.InvalidData", "data is invalid")
}</span>

func NotFound(id string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("FakultasUnit.NotFound", fmt.Sprintf("FakultasUnit with identifier %s not found", id) )
}</span>
</pre>
		
		<pre class="file" id="file3" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type FakultasUnitUpdatedEvent struct {
        EventID    uuid.UUID
        FakultasUnitUUID    uuid.UUID
        OccurredOn time.Time
}

func (e FakultasUnitUpdatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e FakultasUnitUpdatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file4" style="display: none">package domain

import (
        "time"

        common "UnpakSiamida/common/domain"

        "github.com/google/uuid"
)

type IndikatorRenstra struct {
        common.Entity

        ID              uint       `gorm:"primaryKey;autoIncrement"`
        UUID            uuid.UUID  `gorm:"type:char(36);uniqueIndex"`
        StandarRenstra  *uint      `gorm:"column:id_master_standar;"`
        Indikator       string     `gorm:"type:longtext;not null"`
        Parent          *uint      `gorm:""`
        Tahun           string     `gorm:"size:255;not null"`
        TipeTarget      string     `gorm:"size:255;not null"`
        Operator        *string    `gorm:""`
}

func (IndikatorRenstra) TableName() string <span class="cov0" title="0">{
        return "master_indikator_renstra"
}</span>

func NewIndikatorRenstra(
        indikator string,
        standar *uint,
        parent *uint,
        tahun string,
        tipeTarget string,
        operator *string,
        isUniqueIndikator bool,
) common.ResultValue[*IndikatorRenstra] <span class="cov8" title="1">{

        if standar == nil </span><span class="cov8" title="1">{
                return common.FailureValue[*IndikatorRenstra](InvalidStandar())
        }</span>

        <span class="cov8" title="1">if !isUniqueIndikator </span><span class="cov8" title="1">{
                return common.FailureValue[*IndikatorRenstra](NotUniqueIndikator())
        }</span>

        <span class="cov8" title="1">ir := &amp;IndikatorRenstra{
                UUID:           uuid.New(),
                Indikator:      indikator,
                StandarRenstra: standar,
                Parent:         parent,
                Tahun:          tahun,
                TipeTarget:     tipeTarget,
                Operator:       operator,
        }

        ir.Raise(IndikatorRenstraCreatedEvent{
                EventID:              uuid.New(),
                OccurredOn:           time.Now().UTC(),
                IndikatorRenstraUUID: ir.UUID,
        })

        return common.SuccessValue(ir)</span>
}

func UpdateIndikatorRenstra(
        prev *IndikatorRenstra,
        uid uuid.UUID,
        indikator string,
        standar *uint,
        parent *uint,
        tahun string,
        tipeTarget string,
        operator *string,
        // isUniqueIndikator bool,
) common.ResultValue[*IndikatorRenstra] <span class="cov8" title="1">{

        if standar == nil </span><span class="cov8" title="1">{
                return common.FailureValue[*IndikatorRenstra](InvalidStandar())
        }</span>

        // if !isUniqueIndikator {
        //         return common.FailureValue[*IndikatorRenstra](NotUniqueIndikator())
        // }

        <span class="cov8" title="1">if prev == nil </span><span class="cov8" title="1">{
                return common.FailureValue[*IndikatorRenstra](EmptyData())
        }</span>

        <span class="cov8" title="1">if prev.UUID != uid </span><span class="cov8" title="1">{
                return common.FailureValue[*IndikatorRenstra](InvalidData())
        }</span>

        // always overwrite (required field)
        <span class="cov8" title="1">prev.Indikator = indikator
        prev.Tahun = tahun
        prev.TipeTarget = tipeTarget

        // optional pointer fields updated only if not nil
        if standar != nil </span><span class="cov8" title="1">{
                prev.StandarRenstra = standar
        }</span>

        <span class="cov8" title="1">if parent != nil </span><span class="cov8" title="1">{
                prev.Parent = parent
        }</span>

        <span class="cov8" title="1">if operator != nil </span><span class="cov8" title="1">{
                prev.Operator = operator
        }</span>

        <span class="cov8" title="1">prev.Raise(IndikatorRenstraUpdatedEvent{
                EventID:              uuid.New(),
                OccurredOn:           time.Now().UTC(),
                IndikatorRenstraUUID: prev.UUID,
        })

        return common.SuccessValue(prev)</span>
}
</pre>
		
		<pre class="file" id="file5" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type IndikatorRenstraCreatedEvent struct {
        EventID    uuid.UUID
        IndikatorRenstraUUID    uuid.UUID
        OccurredOn time.Time
}

func (e IndikatorRenstraCreatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e IndikatorRenstraCreatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file6" style="display: none">package domain

import (
        "UnpakSiamida/common/domain"
        "fmt"
)

func EmptyData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("IndikatorRenstra.EmptyData", "data is not found")
}</span>

func InvalidUuid() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("IndikatorRenstra.InvalidUuid", "uuid is invalid")
}</span>

func InvalidStandar() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("IndikatorRenstra.InvalidStandar", "standar renstra is invalid")
}</span>

func InvalidParent() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("IndikatorRenstra.InvalidParent", "parent is invalid")
}</span>

func NotUniqueIndikator() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("IndikatorRenstra.NotUniqueIndikator", "indikator is not unique")
}</span>

func InvalidData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("IndikatorRenstra.InvalidData", "data is invalid")
}</span>

func NotFound(id string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("IndikatorRenstra.NotFound", fmt.Sprintf("IndikatorRenstra with identifier %s not found", id) )
}</span>
</pre>
		
		<pre class="file" id="file7" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type IndikatorRenstraUpdatedEvent struct {
        EventID    uuid.UUID
        IndikatorRenstraUUID    uuid.UUID
        OccurredOn time.Time
}

func (e IndikatorRenstraUpdatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e IndikatorRenstraUpdatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file8" style="display: none">package domain

import (
        common "UnpakSiamida/common/domain"

        "github.com/google/uuid"
)

type JenisFile struct {
        common.Entity

        ID              uint       `gorm:"primaryKey;autoIncrement"`
        UUID            uuid.UUID  `gorm:"type:char(36);uniqueIndex"`
        Nama                       string     `gorm:"type:longtext;not null"`
}

func (JenisFile) TableName() string <span class="cov0" title="0">{
        return "jenis_file_renstra"
}</pre>
		
		<pre class="file" id="file9" style="display: none">package domain

import (
        "UnpakSiamida/common/domain"
        "fmt"
)

func EmptyData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("JenisFile.EmptyData", "data is not found")
}</span>

func InvalidUuid() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("JenisFile.InvalidUuid", "uuid is invalid")
}</span>

func NotFound(id string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("JenisFile.NotFound", fmt.Sprintf("JenisFile with identifier %s not found", id) )
}</span>
</pre>
		
		<pre class="file" id="file10" style="display: none">package domain

import (
        "time"

        common "UnpakSiamida/common/domain"

        "github.com/google/uuid"
)

type Renstra struct {
        common.Entity

        ID                                              uint       `gorm:"primaryKey;autoIncrement"`
        UUID                                            uuid.UUID  `gorm:"type:char(36);uniqueIndex"`
        Tahun                                           string     `gorm:"size:255;not null"`
        FakultasUnit                                          uint       `gorm:"column:fakultas_unit;"`
        PeriodeUploadMulai                          string     `gorm:"column:periode_upload_mulai;"`
        PeriodeUploadAkhir                          string     `gorm:"column:periode_upload_akhir;"`
        PeriodeAssesmentDokumenMulai          string     `gorm:"column:periode_assesment_dokumen_mulai;"`
        PeriodeAssesmentDokumenAkhir          string     `gorm:"column:periode_assesment_dokumen_akhir;"`
        PeriodeAssesmentLapanganMulai          string     `gorm:"column:periode_assesment_lapangan_mulai;"`
        PeriodeAssesmentLapanganAkhir          string     `gorm:"column:periode_assesment_lapangan_akhir;"`
        KodeAkses                                                  *string     `gorm:"column:kodeAkses;"`
        Auditee                                                  uint             `gorm:""`
        Auditor1                                                  uint             `gorm:""`
        Auditor2                                                  uint             `gorm:""`
        Catatan1                                                  *string     `gorm:"column:catatan;"`
        Catatan2                                                  *string     `gorm:"column:catatan2;"`
}

func (Renstra) TableName() string <span class="cov0" title="0">{
        return "renstra"
}</span>

// ------------------------
// Helper: check overlap
// ------------------------
func isOverlap(start1, end1, start2, end2 time.Time) bool <span class="cov8" title="1">{
        return !end1.Before(start2) &amp;&amp; !end2.Before(start1)
}</span>

// ------------------------
// Create New Renstra
// ------------------------
func NewRenstra(
        tahun string,
        fakultasUnit uint,
        periodeUploadMulai, periodeUploadAkhir string,
        periodeDokumenMulai, periodeDokumenAkhir string,
        periodeLapanganMulai, periodeLapanganAkhir string,
        auditee, auditor1, auditor2 uint,
        isUniqueData bool,
) common.ResultValue[*Renstra] <span class="cov8" title="1">{

        if fakultasUnit &lt;= 0 </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidFakultasUnit())
        }</span>

        <span class="cov8" title="1">if !isUniqueData </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](DataExisting())
        }</span>

        <span class="cov8" title="1">if auditee &lt;= 0 </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](MissingAuditee())
        }</span>
        <span class="cov8" title="1">if auditor1 &lt;= 0</span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](MissingAuditor1())
        }</span>
        <span class="cov8" title="1">if auditor2 &lt;= 0 </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](MissingAuditor2())
        }</span>

        <span class="cov8" title="1">if auditee == auditor1 || auditee == auditor2 || auditor1 == auditor2 </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](DuplicateAssigment())
        }</span>

        <span class="cov8" title="1">format := "2006-01-02"

        // Periode Upload
        startUpload, err := time.Parse(format, periodeUploadMulai)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("upload"))
        }</span>
        <span class="cov8" title="1">endUpload, err := time.Parse(format, periodeUploadAkhir)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("upload"))
        }</span>

        // Periode Assessment Dokumen
        <span class="cov8" title="1">startDokumen, err := time.Parse(format, periodeDokumenMulai)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("assessment dokumen"))
        }</span>
        <span class="cov8" title="1">endDokumen, err := time.Parse(format, periodeDokumenAkhir)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("assessment dokumen"))
        }</span>

        // Periode Assessment Lapangan
        <span class="cov8" title="1">startLapangan, err := time.Parse(format, periodeLapanganMulai)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("assessment lapangan"))
        }</span>
        <span class="cov8" title="1">endLapangan, err := time.Parse(format, periodeLapanganAkhir)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("assessment lapangan"))
        }</span>

        // Cek overlap
        <span class="cov8" title="1">if isOverlap(startUpload, endUpload, startDokumen, endDokumen) </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](PeriodOverlapUploadDokumen())
        }</span>

        <span class="cov8" title="1">if isOverlap(startUpload, endUpload, startLapangan, endLapangan) </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](PeriodOverlapUploadLapangan())
        }</span>

        <span class="cov8" title="1">if isOverlap(startDokumen, endDokumen, startLapangan, endLapangan) </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](PeriodOverlapDokumenLapangan())
        }</span>

        <span class="cov8" title="1">renstra := &amp;Renstra{
                UUID:                       uuid.New(),
                Tahun:                      tahun,
                FakultasUnit:               fakultasUnit,
                PeriodeUploadMulai:         periodeUploadMulai,
                PeriodeUploadAkhir:         periodeUploadAkhir,
                PeriodeAssesmentDokumenMulai: periodeDokumenMulai,
                PeriodeAssesmentDokumenAkhir: periodeDokumenAkhir,
                PeriodeAssesmentLapanganMulai: periodeLapanganMulai,
                PeriodeAssesmentLapanganAkhir: periodeLapanganAkhir,
                Auditee:                    auditee,
                Auditor1:                   auditor1,
                Auditor2:                   auditor2,
        }

        renstra.Raise(RenstraCreatedEvent{
                EventID:    uuid.New(),
                OccurredOn: time.Now().UTC(),
                RenstraUUID: renstra.UUID,
        })

        return common.SuccessValue(renstra)</span>
}

func GiveCodeAccessRenstra(
        prev *Renstra,
        uid uuid.UUID,
        kodeAkses string,
) common.ResultValue[*Renstra] <span class="cov8" title="1">{

        if prev == nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](EmptyData())
        }</span>

        <span class="cov8" title="1">if prev.UUID != uid </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidData())
        }</span>

        <span class="cov8" title="1">prev.KodeAkses = &amp;kodeAkses

        prev.Raise(RenstraGiveCodeAccessEvent{
                EventID:              uuid.New(),
                OccurredOn:           time.Now().UTC(),
                RenstraUUID: prev.UUID,
        })

        return common.SuccessValue(prev)</span>
}

func UpdateRenstra(
        prev *Renstra,
        uid uuid.UUID,
        tahun string,
        fakultasUnit uint,
        periodeUploadMulai, periodeUploadAkhir string,
        periodeDokumenMulai, periodeDokumenAkhir string,
        periodeLapanganMulai, periodeLapanganAkhir string,
        auditee, auditor1, auditor2 uint,
) common.ResultValue[*Renstra] <span class="cov8" title="1">{

        if prev == nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](EmptyData())
        }</span>

        <span class="cov8" title="1">if prev.UUID != uid </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidData())
        }</span>

        <span class="cov8" title="1">if fakultasUnit &lt;= 0 </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidFakultasUnit())
        }</span>

        <span class="cov8" title="1">if auditee &lt;= 0 </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](MissingAuditee())
        }</span>
        <span class="cov8" title="1">if auditor1 &lt;= 0</span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](MissingAuditor1())
        }</span>
        <span class="cov8" title="1">if auditor2 &lt;= 0 </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](MissingAuditor2())
        }</span>

        <span class="cov8" title="1">if auditee == auditor1 || auditee == auditor2 || auditor1 == auditor2 </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](DuplicateAssigment())
        }</span>

        <span class="cov8" title="1">format := "2006-01-02"

        // Periode Upload
        startUpload, err := time.Parse(format, periodeUploadMulai)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("upload"))
        }</span>
        <span class="cov8" title="1">endUpload, err := time.Parse(format, periodeUploadAkhir)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("upload"))
        }</span>

        // Periode Assessment Dokumen
        <span class="cov8" title="1">startDokumen, err := time.Parse(format, periodeDokumenMulai)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("assessment dokumen"))
        }</span>
        <span class="cov8" title="1">endDokumen, err := time.Parse(format, periodeDokumenAkhir)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("assessment dokumen"))
        }</span>

        // Periode Assessment Lapangan
        <span class="cov8" title="1">startLapangan, err := time.Parse(format, periodeLapanganMulai)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("assessment lapangan"))
        }</span>
        <span class="cov8" title="1">endLapangan, err := time.Parse(format, periodeLapanganAkhir)
        if err != nil </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](InvalidDate("assessment lapangan"))
        }</span>

        // Cek overlap
        <span class="cov8" title="1">if isOverlap(startUpload, endUpload, startDokumen, endDokumen) </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](PeriodOverlapUploadDokumen())
        }</span>

        <span class="cov8" title="1">if isOverlap(startUpload, endUpload, startLapangan, endLapangan) </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](PeriodOverlapUploadLapangan())
        }</span>

        <span class="cov8" title="1">if isOverlap(startDokumen, endDokumen, startLapangan, endLapangan) </span><span class="cov8" title="1">{
                return common.FailureValue[*Renstra](PeriodOverlapDokumenLapangan())
        }</span>

        // always overwrite (required field)
        <span class="cov8" title="1">prev.Tahun =                      tahun
        prev.FakultasUnit =               fakultasUnit
        prev.PeriodeUploadMulai =         periodeUploadMulai
        prev.PeriodeUploadAkhir =         periodeUploadAkhir
        prev.PeriodeAssesmentDokumenMulai = periodeDokumenMulai
        prev.PeriodeAssesmentDokumenAkhir = periodeDokumenAkhir
        prev.PeriodeAssesmentLapanganMulai = periodeLapanganMulai
        prev.PeriodeAssesmentLapanganAkhir = periodeLapanganAkhir
        prev.Auditee =                    auditee
        prev.Auditor1 = auditor1
        prev.Auditor2 = auditor2
        
        prev.Raise(RenstraUpdatedEvent{
                EventID:              uuid.New(),
                OccurredOn:           time.Now().UTC(),
                RenstraUUID: prev.UUID,
        })

        return common.SuccessValue(prev)</span>
}
</pre>
		
		<pre class="file" id="file11" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type RenstraCreatedEvent struct {
        EventID    uuid.UUID
        RenstraUUID    uuid.UUID
        OccurredOn time.Time
}

func (e RenstraCreatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e RenstraCreatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file12" style="display: none">package domain

import (
        "UnpakSiamida/common/domain"
        "fmt"
)

func EmptyData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.EmptyData", "data is not found")
}</span>

func InvalidUuid() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.InvalidUuid", "uuid is invalid")
}</span>

func InvalidData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.InvalidData", "data is invalid")
}</span>

func NotFound(id string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.NotFound", fmt.Sprintf("Renstra with identifier %s not found", id) )
}</span>

func InvalidFakultasUnit() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.InvalidFakultasUnit", "fakultas unit is invalid")
}</span>

func DataExisting() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.DataExisting", "the audit data form already existed before")
}</span>

func MissingAuditee() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.MissingAuditee", "auditee have not been assigned")
}</span>

func MissingAuditor1() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.MissingAuditor1", "auditor1 have not been assigned")
}</span>

func MissingAuditor2() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.MissingAuditor2", "auditor2 have not been assigned")
}</span>

func InvalidParsing(target string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.IvalidParsing", fmt.Sprintf("failed parsing %s to UUID", target) )
}</span>

func DuplicateAssigment() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.DuplicateAssigment", "auditee, auditee 1, and auditor 2 must not have the same target")
}</span>

func InvalidDate(target string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.InvalidDate", fmt.Sprintf("%s period have wrong date format", target) )
}</span>

func PeriodOverlapUploadDokumen() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.PeriodOverlapUploadDokumen", "upload period overlaps with document period")
}</span>

func PeriodOverlapUploadLapangan() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.PeriodOverlapUploadLapangan", "upload period overlaps with AL period")
}</span>

func PeriodOverlapDokumenLapangan() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("Renstra.PeriodOverlapDokumenLapangan", "document period overlaps with AL period")
}</pre>
		
		<pre class="file" id="file13" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type RenstraGiveCodeAccessEvent struct {
        EventID    uuid.UUID
        RenstraUUID    uuid.UUID
        OccurredOn time.Time
}

func (e RenstraGiveCodeAccessEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e RenstraGiveCodeAccessEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file14" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type RenstraUpdatedEvent struct {
        EventID    uuid.UUID
        RenstraUUID    uuid.UUID
        OccurredOn time.Time
}

func (e RenstraUpdatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e RenstraUpdatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file15" style="display: none">package domain

import (
        "time"

        common "UnpakSiamida/common/domain"

        "github.com/google/uuid"
)

type StandarRenstra struct {
        common.Entity
        ID           uint       `gorm:"primaryKey;autoIncrement"`
        UUID         uuid.UUID  `gorm:"type:char(36);uniqueIndex"`
        Nama         string     `gorm:"type:longtext;not null"`
}
func (StandarRenstra) TableName() string <span class="cov0" title="0">{
        return "master_standar_renstra"
}</span>


// === CREATE ===
func NewStandarRenstra(nama string) common.ResultValue[*StandarRenstra] <span class="cov8" title="1">{

        standarrenstra := &amp;StandarRenstra{
                UUID:         uuid.New(),
                Nama:         nama,
        }

        standarrenstra.Raise(StandarRenstraCreatedEvent{
                EventID:    uuid.New(),
                OccurredOn: time.Now().UTC(),
                StandarRenstraUUID:   standarrenstra.UUID,
        })

        return common.SuccessValue(standarrenstra)
}</span>

// === UPDATE ===
func UpdateStandarRenstra(
        prev *StandarRenstra, 
        uid uuid.UUID,
        nama string,
) common.ResultValue[*StandarRenstra] <span class="cov8" title="1">{

        if prev == nil </span><span class="cov8" title="1">{
                return common.FailureValue[*StandarRenstra](EmptyData())
        }</span>

        <span class="cov8" title="1">if prev.UUID != uid </span><span class="cov8" title="1">{
                return common.FailureValue[*StandarRenstra](InvalidData())
        }</span>

        <span class="cov8" title="1">prev.Nama = nama

        prev.Raise(StandarRenstraUpdatedEvent{
                EventID:           uuid.New(),
                OccurredOn: time.Now().UTC(),
                StandarRenstraUUID:   prev.UUID,
        })

        return common.SuccessValue(prev)</span>
}
</pre>
		
		<pre class="file" id="file16" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type StandarRenstraCreatedEvent struct {
        EventID    uuid.UUID
        StandarRenstraUUID    uuid.UUID
        OccurredOn time.Time
}

func (e StandarRenstraCreatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e StandarRenstraCreatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file17" style="display: none">package domain

import (
        "UnpakSiamida/common/domain"
        "fmt"
)

func EmptyData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("StandarRenstra.EmptyData", "data is not found")
}</span>

func InvalidUuid() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("StandarRenstra.InvalidUuid", "uuid is invalid")
}</span>

func InvalidData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("StandarRenstra.InvalidData", "data is invalid")
}</span>

func NotFound(id string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("StandarRenstra.NotFound", fmt.Sprintf("StandarRenstra with identifier %s not found", id) )
}</span>
</pre>
		
		<pre class="file" id="file18" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type StandarRenstraUpdatedEvent struct {
        EventID    uuid.UUID
        StandarRenstraUUID    uuid.UUID
        OccurredOn time.Time
}

func (e StandarRenstraUpdatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e StandarRenstraUpdatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file19" style="display: none">package domain

import (
        common "UnpakSiamida/common/domain"
)

type TahunRenstra struct {
        common.Entity
        Tahun        string     `gorm:""`
        Status       string     `gorm:""`
}
func (TahunRenstra) TableName() string <span class="cov0" title="0">{
        return "v_tahun_renstra"
}</pre>
		
		<pre class="file" id="file20" style="display: none">package domain

import (
        "UnpakSiamida/common/domain"
        "fmt"
)

func EmptyData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TahunRenstra.EmptyData", "data is not found")
}</span>

func NotFound(id string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TahunRenstra.NotFound", fmt.Sprintf("TahunRenstra with identifier %s not found", id) )
}</span>
</pre>
		
		<pre class="file" id="file21" style="display: none">package domain

import (
        "time"

        common "UnpakSiamida/common/domain"

        "github.com/google/uuid"
)

type TemplateDokumenTambahan struct {
        common.Entity
        ID          uint           `gorm:"primaryKey;autoIncrement"`
        UUID        uuid.UUID      `gorm:"type:char(36);uniqueIndex"`
        Tahun       string
        JenisFileID uint           `gorm:"column:jenis_file"`
        Pertanyaan  string         `gorm:"type:longtext"`
        Klasifikasi string
        Kategori    string         `gorm:"column:fakultas_prodi_unit"`
        Tugas       string
}
func (TemplateDokumenTambahan) TableName() string <span class="cov0" title="0">{
        return "template_dokumen_tambahan"
}</span>


// === CREATE ===
func NewTemplateDokumenTambahan(
        tahun                      string,
        jenisFileID                 uint,
        pertanyaan              string,
        klasifikasi                string,
        kategori                   string,
        tugas                      string,
) common.ResultValue[*TemplateDokumenTambahan] <span class="cov8" title="1">{
        if jenisFileID&lt;=0</span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateDokumenTambahan](JenisFileNotFound())
        }</span>

        <span class="cov8" title="1">templatedokumentambahan := &amp;TemplateDokumenTambahan{
                UUID: uuid.New(),
                Tahun: tahun,
                JenisFileID: jenisFileID,
                Pertanyaan: pertanyaan,
                Klasifikasi: klasifikasi,
                Kategori: kategori,
                Tugas: tugas,
        }

        templatedokumentambahan.Raise(TemplateDokumenTambahanCreatedEvent{
                EventID:    uuid.New(),
                OccurredOn: time.Now().UTC(),
                TemplateDokumenTambahanUUID:   templatedokumentambahan.UUID,
        })

        return common.SuccessValue(templatedokumentambahan)</span>
}

// === UPDATE ===
func UpdateTemplateDokumenTambahan(
        prev *TemplateDokumenTambahan, 
        uid uuid.UUID,
        tahun                      string,
        jenisFileID                 uint,
        pertanyaan              string,
        klasifikasi                string,
        kategori                   string,
        tugas                      string,
) common.ResultValue[*TemplateDokumenTambahan] <span class="cov8" title="1">{
        
        if prev == nil </span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateDokumenTambahan](EmptyData())
        }</span>
        <span class="cov8" title="1">if prev.UUID != uid </span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateDokumenTambahan](InvalidData())
        }</span>
        <span class="cov8" title="1">if jenisFileID&lt;=0</span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateDokumenTambahan](JenisFileNotFound())
        }</span>

        <span class="cov8" title="1">prev.Tahun = tahun
        prev.JenisFileID = jenisFileID
        prev.Pertanyaan = pertanyaan
        prev.Klasifikasi = klasifikasi
        prev.Kategori = kategori
        prev.Tugas = tugas

        prev.Raise(TemplateDokumenTambahanUpdatedEvent{
                EventID:           uuid.New(),
                OccurredOn: time.Now().UTC(),
                TemplateDokumenTambahanUUID:   prev.UUID,
        })

        return common.SuccessValue(prev)</span>
}
</pre>
		
		<pre class="file" id="file22" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type TemplateDokumenTambahanCreatedEvent struct {
        EventID    uuid.UUID
        TemplateDokumenTambahanUUID    uuid.UUID
        OccurredOn time.Time
}

func (e TemplateDokumenTambahanCreatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e TemplateDokumenTambahanCreatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file23" style="display: none">package domain

import (
        "UnpakSiamida/common/domain"
        "fmt"
)

func EmptyData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateDokumenTambahan.EmptyData", "data is not found")
}</span>

func InvalidUuid() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateDokumenTambahan.InvalidUuid", "uuid is invalid")
}</span>

func JenisFileNotFound() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateDokumenTambahan.JenisFileNotFound", "fakultas unit not found")
}</span>

func InvalidData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateDokumenTambahan.InvalidData", "data is invalid")
}</span>

func NotFound(id string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateDokumenTambahan.NotFound", fmt.Sprintf("TemplateDokumenTambahan with identifier %s not found", id) )
}</span>
</pre>
		
		<pre class="file" id="file24" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type TemplateDokumenTambahanUpdatedEvent struct {
        EventID    uuid.UUID
        TemplateDokumenTambahanUUID    uuid.UUID
        OccurredOn time.Time
}

func (e TemplateDokumenTambahanUpdatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e TemplateDokumenTambahanUpdatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file25" style="display: none">package domain

import (
        "time"

        common "UnpakSiamida/common/domain"

        "github.com/google/uuid"
)

type TemplateRenstra struct {
        common.Entity
        ID                      uint       `gorm:"primaryKey;autoIncrement"`
        UUID                    uuid.UUID  `gorm:"type:char(36);uniqueIndex"`
        Tahun              string          `gorm:""`
        IndikatorRenstraID uint                  `gorm:"column:indikator;"`
        IsPertanyaan       bool           `gorm:"column:pertanyaan;"`
        FakultasUnit       uint           `gorm:"column:fakultas_unit;"`
        Kategori           string           `gorm:""`
        Klasifikasi        string          `gorm:""`
        Satuan             *string          `gorm:""`
        Target             *string          `gorm:""`
        TargetMin          *string          `gorm:"column:target_min;"`
        TargetMax          *string          `gorm:"column:target_max;"`
        Tugas              string          `gorm:""`
}
func (TemplateRenstra) TableName() string <span class="cov0" title="0">{
        return "template_renstra"
}</span>


// === CREATE ===
func NewTemplateRenstra(
        tahun              string,
        indikatorRenstraID uint,
        isPertanyaan       bool,
        fakultasUnit       uint,
        kategori           string,
        klasifikasi        string,
        satuan             *string,
        target             *string,
        targetMin          *string,
        targetMax          *string,
        tugas              string,
) common.ResultValue[*TemplateRenstra] <span class="cov8" title="1">{
        hasTarget := target != nil &amp;&amp; *target != ""
        hasTargetMin := targetMin != nil &amp;&amp; *targetMin != ""
        hasTargetMax := targetMax != nil &amp;&amp; *targetMax != ""

        // Valid hanya jika:
        // - Mode A: hasTarget == true AND hasTargetMin == false AND hasTargetMax == false
        // - Mode B: hasTarget == false AND hasTargetMin == true AND hasTargetMax == true
        if !( (hasTarget &amp;&amp; !hasTargetMin &amp;&amp; !hasTargetMax) ||
                (!hasTarget &amp;&amp; hasTargetMin &amp;&amp; hasTargetMax) ) </span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateRenstra](InvalidValueTarget())
        }</span>
        <span class="cov8" title="1">if indikatorRenstraID&lt;=0</span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateRenstra](IndikatorNotFound())
        }</span>
        <span class="cov8" title="1">if fakultasUnit&lt;=0</span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateRenstra](FakultasUnitNotFound())
        }</span>

        <span class="cov8" title="1">templaterenstra := &amp;TemplateRenstra{
                UUID: uuid.New(),
                Tahun: tahun,
                IndikatorRenstraID: indikatorRenstraID,
                IsPertanyaan: isPertanyaan,
                FakultasUnit: fakultasUnit,
                Kategori: kategori,
                Klasifikasi: klasifikasi,
                Satuan: satuan,
                Target: target,
                TargetMin: targetMin,
                TargetMax: targetMax,
                Tugas: tugas,
        }

        templaterenstra.Raise(TemplateRenstraCreatedEvent{
                EventID:    uuid.New(),
                OccurredOn: time.Now().UTC(),
                TemplateRenstraUUID:   templaterenstra.UUID,
        })

        return common.SuccessValue(templaterenstra)</span>
}

// === UPDATE ===
func UpdateTemplateRenstra(
        prev *TemplateRenstra, 
        uid uuid.UUID,
        tahun              string,
        indikatorRenstraID uint,
        isPertanyaan       bool,
        fakultasUnit       uint,
        kategori           string,
        klasifikasi        string,
        satuan             *string,
        target             *string,
        targetMin          *string,
        targetMax          *string,
        tugas              string,
) common.ResultValue[*TemplateRenstra] <span class="cov8" title="1">{
        
        hasTarget := target != nil &amp;&amp; *target != ""
        hasTargetMin := targetMin != nil &amp;&amp; *targetMin != ""
        hasTargetMax := targetMax != nil &amp;&amp; *targetMax != ""

        if prev == nil </span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateRenstra](EmptyData())
        }</span>
        <span class="cov8" title="1">if prev.UUID != uid </span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateRenstra](InvalidData())
        }</span>
        // Valid hanya jika:
        // - Mode A: hasTarget == true AND hasTargetMin == false AND hasTargetMax == false
        // - Mode B: hasTarget == false AND hasTargetMin == true AND hasTargetMax == true
        <span class="cov8" title="1">if !( (hasTarget &amp;&amp; !hasTargetMin &amp;&amp; !hasTargetMax) ||
                (!hasTarget &amp;&amp; hasTargetMin &amp;&amp; hasTargetMax) ) </span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateRenstra](InvalidValueTarget())
        }</span>
        <span class="cov8" title="1">if indikatorRenstraID&lt;=0</span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateRenstra](IndikatorNotFound())
        }</span>
        <span class="cov8" title="1">if fakultasUnit&lt;=0</span><span class="cov8" title="1">{
                return common.FailureValue[*TemplateRenstra](FakultasUnitNotFound())
        }</span>

        <span class="cov8" title="1">prev.Tahun = tahun
        prev.IndikatorRenstraID = indikatorRenstraID
        prev.IsPertanyaan = isPertanyaan
        prev.FakultasUnit = fakultasUnit
        prev.Kategori = kategori
        prev.Klasifikasi = klasifikasi
        prev.Satuan = satuan
        prev.Target = target
        prev.TargetMin = targetMin
        prev.TargetMax = targetMax
        prev.Tugas = tugas

        prev.Raise(TemplateRenstraUpdatedEvent{
                EventID:           uuid.New(),
                OccurredOn: time.Now().UTC(),
                TemplateRenstraUUID:   prev.UUID,
        })

        return common.SuccessValue(prev)</span>
}
</pre>
		
		<pre class="file" id="file26" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type TemplateRenstraCreatedEvent struct {
        EventID    uuid.UUID
        TemplateRenstraUUID    uuid.UUID
        OccurredOn time.Time
}

func (e TemplateRenstraCreatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e TemplateRenstraCreatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file27" style="display: none">package domain

import (
        "UnpakSiamida/common/domain"
        "fmt"
)

func EmptyData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateRenstra.EmptyData", "data is not found")
}</span>

func InvalidUuid() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateRenstra.InvalidUuid", "uuid is invalid")
}</span>

func IndikatorNotFound() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateRenstra.IndikatorNotFound", "indikator not found")
}</span>

func FakultasUnitNotFound() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateRenstra.FakultasUnitNotFound", "fakultas unit not found")
}</span>

func InvalidValueTarget() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateRenstra.InvalidValueTarget", "invalid target combination, either provide Target only or provide both TargetMin and TargetMax")
}</span>

func InvalidData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateRenstra.InvalidData", "data is invalid")
}</span>

func NotFound(id string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("TemplateRenstra.NotFound", fmt.Sprintf("TemplateRenstra with identifier %s not found", id) )
}</span>
</pre>
		
		<pre class="file" id="file28" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type TemplateRenstraUpdatedEvent struct {
        EventID    uuid.UUID
        TemplateRenstraUUID    uuid.UUID
        OccurredOn time.Time
}

func (e TemplateRenstraUpdatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e TemplateRenstraUpdatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file29" style="display: none">package domain

import (
        "time"

        common "UnpakSiamida/common/domain"
        helper "UnpakSiamida/common/helper"

        "github.com/google/uuid"
)

type User struct {
        common.Entity
        ID           uint       `gorm:"primaryKey;autoIncrement"`
        UUID         uuid.UUID  `gorm:"type:char(36);uniqueIndex"`
        Username     string     `gorm:"column:nidn_username;size:100;not null"`
        Password          string     `gorm:"type:longtext;not null"`
        Name         string     `gorm:"size:255;not null"`
        Email        string     `gorm:"size:255;"`
        Level        string     `gorm:"size:255;"`
        FakultasUnit *int       `gorm:"column:fakultas_unit;"`
}
func (User) TableName() string <span class="cov0" title="0">{
        return "users"
}</span>


// === CREATE ===
func NewUser(username string, password string, name string, email string, level string, fakultasunit *int) common.ResultValue[*User] <span class="cov8" title="1">{

        if !helper.IsValidUnpakEmail(email) </span><span class="cov8" title="1">{
                return common.FailureValue[*User](InvalidEmail())
        }</span>

        <span class="cov8" title="1">user := &amp;User{
                UUID:         uuid.New(),
                Username:     username,
                Password:     password,
                Name:         name,
                Email:        email,
                Level:                   level,
                FakultasUnit: fakultasunit,
        }

        user.Raise(UserCreatedEvent{
                EventID:    uuid.New(),
                OccurredOn: time.Now().UTC(),
                UserUUID:   user.UUID,
        })

        return common.SuccessValue(user)</span>
}

// === UPDATE ===
func UpdateUser(
        prev *User, 
        uid uuid.UUID,
        username string,
        password *string,
        name string,
        email string,
        level string,
        fakultasunit *int,
) common.ResultValue[*User] <span class="cov8" title="1">{

        if prev == nil </span><span class="cov8" title="1">{
                return common.FailureValue[*User](EmptyData())
        }</span>

        <span class="cov8" title="1">if prev.UUID != uid </span><span class="cov8" title="1">{
                return common.FailureValue[*User](InvalidData())
        }</span>

        // check email
        <span class="cov8" title="1">if !helper.IsValidUnpakEmail(email) </span><span class="cov8" title="1">{
                return common.FailureValue[*User](InvalidEmail())
        }</span>

        // update opsional
        <span class="cov8" title="1">if password != nil </span><span class="cov8" title="1">{
                prev.Password = *password
        }</span>
        <span class="cov8" title="1">prev.Name = name
        prev.Email = email
        prev.Level = level

        if fakultasunit != nil </span><span class="cov8" title="1">{
                prev.FakultasUnit = fakultasunit
        }</span>

        <span class="cov8" title="1">prev.Raise(UserUpdatedEvent{
                EventID:           uuid.New(),
                OccurredOn: time.Now().UTC(),
                UserUUID:   prev.UUID,
        })

        return common.SuccessValue(prev)</span>
}
</pre>
		
		<pre class="file" id="file30" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type UserCreatedEvent struct {
        EventID    uuid.UUID
        UserUUID    uuid.UUID
        OccurredOn time.Time
}

func (e UserCreatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e UserCreatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		<pre class="file" id="file31" style="display: none">package domain

import (
        "UnpakSiamida/common/domain"
        "fmt"
)

func EmptyData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("User.EmptyData", "data is not found")
}</span>

func InvalidUuid() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("User.InvalidUuid", "uuid is invalid")
}</span>

func InvalidData() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("User.InvalidData", "data is invalid")
}</span>

func InvalidEmail() domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("User.InvalidEmail", "email tidak valid atau tidak diperbolehkan")
}</span>

func NotFound(id string) domain.Error <span class="cov8" title="1">{
        return domain.NotFoundError("User.NotFound", fmt.Sprintf("User with identifier %s not found", id) )
}</span>
</pre>
		
		<pre class="file" id="file32" style="display: none">package domain

import (
        "time"
        "github.com/google/uuid"
        // "UnpakSiamida/common/domain"
)

type UserUpdatedEvent struct {
        EventID    uuid.UUID
        UserUUID    uuid.UUID
        OccurredOn time.Time
}

func (e UserUpdatedEvent) ID() string <span class="cov0" title="0">{
        return e.EventID.String()
}</span>

func (e UserUpdatedEvent) OccurredOnUTC() time.Time <span class="cov0" title="0">{
        return e.OccurredOn
}</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
